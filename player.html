<!DOCTYPE html>
<html>
  <head>
    <link
      rel="preload"
      as="style"
      onload="this.rel = 'stylesheet'"
      href="https://fonts.googleapis.com/css?family=Lobster|Rampart One|Patrick Hand|Akaya Telivigala"
    />
    <link
      rel="preload"
      as="style"
      onload="this.rel = 'stylesheet'"
      type="text/css"
      href="style.css"
    />
    <link
      rel="shortcut icon"
      href="https://cdn.glitch.global/8187eb85-ef03-4f68-a096-53cb26af1633/favicon.ico?v=1644733950223"
    />
    <title>Good music!</title>
    <meta
      charset="utf-8"
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="detectmobilebrowser.js"></script>

    <div
      id="fullscreenVideo"
      onmousewheel="bpControl()"
      style="cursor: not-allowed"
    >
      <video autoplay loop id="myVideo" preload onloadstart="this.volume=0.4">
        <source src="" id="src" />
      </video>
      <div style="border-radius: 50px" id="snackbar">
        You pressed wrong key!
      </div>
      <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
      <p
        id="tut-volume"
        class="rainbow"
        style="
          position: absolute;
          margin-left: 615px;
          color: white;
          border: 1px solid white;
          padding: 5px;
        "
      >
        Change volume here
      </p>
      <br />
      <br /><br />
      <input
        onmouseenter="text1()"
        onmouseleave="text2()"
        type="range"
        min="0"
        max="100"
        step="1"
        value="40"
        oninput="SetVolume(this.value)"
        onchange="SetVolume(this.value)"
        id="vol-control"
        style="cursor: ew-resize; margin-left: 80vh"
      /><br />
      <span id="curtimetext" style="color: orange; margin-left: 55vh"
        >00:00</span
      ><input
        style="margin: 0 10px 0 10px;s"
        id="seekslider"
        type="range"
        min="0"
        max="100"
        value="0"
        step="1"
      /><span id="durtimetext" style="color: deeppink">00:00</span>
    </div>

    <canvas id="canvas"></canvas>
    <div class="content">
      <h1 class="rainbow" style="text-align: center">
        <b class="blink" style="cursor: default">Lag Player</b>
      </h1>
      <h3 style="opacity: 50%; text-align: center">
        Blur Mode (Made by
        <b
          class="blink"
          style="color: pink; font-family: Segoe Script; cursor: pointer"
          onclick="ytchannel()"
          >Mr884</b
        >)
      </h3>
      <p style="text-align: center">
        <i
          id="title"
          onmouseenter="background1()"
          onmouseleave="background2()"
          onclick="megalovania()"
          style="cursor: pointer"
          >A web player with many interactive buttons and actions</i
        >
      </p>
      <br />
      <p>
        <img src="https://cdn.glitch.global/8187eb85-ef03-4f68-a096-53cb26af1633/icons8-download-24.png?v=1646579092277" />
        <u onclick="installer()" class="blink" style="cursor: pointer;">Download app for Windows</u>
      </p>
      <p>
        Right-click: Fullscreen video - Press ESC in your keyboard to exit
        fullscreen (also you can press F if you're using Firefox)
      </p>
      <button
        id="myBtn"
        data-tooltip="Scroll this"
        data-tooltip-location="right"
        onmousewheel="bpControl(); settime()"
      >
        <span><b style="color: black">TWICE</b></span>
      </button>
      <progress id="progress" max="100" value="0">Progress</progress>
      <p>
        Scroll
        <b
          id="hint"
          style="color: pink"
          onclick="showname()"
          onmouseenter="sansclick()"
        >
          TWICE
        </b>
        to play/pause
      </p>
      <p>
        In fullscreen video : Scroll anywhere to play/pause and right-click
        anywhere to mute/unmute [Scroll in Firefox is unstable, so you can press
        Space]
      </p>
      <br />
      <form>
        <label for="upload" class="custom-file-upload">
          <i class="fa fa-cloud-upload"></i> Choose file...
        </label>
        <input type="file" id="upload" style="display: none" />
      </form>
      <br />
      <button id="reloadBtn" class="centerButton" onclick="home()">
        Reload this page
      </button>
      <br />
      <main>
        <div id="clock" onload="currentTime()" class="submit-feedback"></div>
        <div id="time"></div>
      </main>
    </div>

    <script>
      var video = document.getElementById("myVideo");
      var btn = document.getElementById("myBtn");
      var badtime = document.getElementById("reloadBtn");
      var unit = "s";
      var x = document.getElementById("snackbar");
      var elem = document.getElementById("fullscreenVideo");
      var seekslider = document.getElementById("seekslider");
      var curtimetext = document.getElementById("curtimetext");
      var durtimetext = document.getElementById("durtimetext");
      var sanssrc = document.getElementById("myVideo");
      var name = document.getElementById("upload");
      function settime() {
        if (video.played) console.log(video.currentTime);
        setInterval(function () {
          console.log(video.currentTime);
          document.getElementById("time").innerHTML =
            Math.round(video.currentTime) + unit;
        }, 1000);
      }
      const progress = document.getElementById("progress");
      function progressLoop() {
        setInterval(function () {
          progress.value = Math.round(
            (myVideo.currentTime / myVideo.duration) * 100
          );
        });
      }

      progressLoop();

      function playPageTitle() {
        newPlayTitle = "Playing!";
        document.title = newPlayTitle;
      }
      function pausePageTitle() {
        newPauseTitle = "Paused!";
        document.title = newPauseTitle;
      }
      async function changePageTitle() {
        var name = document.getElementById("upload");
        await sleep(1000);
        newPageTitle = name.files.item(0).name;
        document.title = newPageTitle;
      }

      function musicTitle() {
        var name = document.getElementById("upload");
        if (src != "") {
          musicTitle = name.files.item(0).name;
          document.title = musicTitle;
        }
      }

      function home() {
        location.reload(true);
      }
      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }
      function bpControl() {
        var name = document.getElementById("upload");
        if (video.paused) {
          video.play();
          btn.innerHTML = "TWICE (⏸️)";
          playPageTitle();
          changePageTitle();
        } else {
          video.pause();
          btn.innerHTML = "TWICE (▶)";
          pausePageTitle();
          changePageTitle();
        }
      }
      function megalovania() {
        if (video.played) video.pause();
        btn.innerHTML = "TWICE (▶)";
        window.open(
          "https://drive.google.com/file/d/1Q1AZyXGnW1ZZL9NNPhUb2HxRong1xcUH/view?usp=sharing"
        );
      }
      function installer() {
        if (video.played) {
          video.pause();
          btn.innerHTML = "TWICE";
          window.open(
            "https://cdn.glitch.me/8187eb85-ef03-4f68-a096-53cb26af1633/LAG%20Setup.exe?v=1647786803928"
          );
        }
      }
      function sansclick() {}
      function ytchannel() {
        window.open("https://www.youtube.com/channel/UC8Hhy9h1CJiRRajHca1BWJQ");
      }
      function currentTime() {
        let date = new Date();
        let hh = date.getHours();
        let mm = date.getMinutes();
        let ss = date.getSeconds();
        let session = "AM";

        if (hh > 12) {
          session = "PM";
        }

        hh = hh < 10 ? "0" + hh : hh;
        mm = mm < 10 ? "0" + mm : mm;
        ss = ss < 10 ? "0" + ss : ss;

        let time = hh + ":" + mm + ":" + ss + " " + session;

        document.getElementById("clock").innerText =
          time + " [MUTE/UNMUTE VIDEO HERE]";
        let t = setTimeout(function () {
          currentTime();
        }, 1000);
      }

      function openFullscreen() {
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          /* Safari */
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
          /* IE11 */
          elem.msRequestFullscreen();
        }
        document.getElementById("vol-control").style.display = "";
        document.getElementById("curtimetext").style.display = "";
        document.getElementById("durtimetext").style.display = "";
        document.getElementById("seekslider").style.display = "";
      }
      /* Close fullscreen */
      function closeFullscreen() {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          /* Safari */
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          /* IE11 */
          document.msExitFullscreen();
        }
        document.getElementById("vol-control").style.display = "none";
        document.getElementById("curtimetext").style.display = "none";
        document.getElementById("durtimetext").style.display = "none";
        document.getElementById("seekslider").style.display = "none";
        document.getElementById("tut-volume").style.display = "none";
      }

      function vidSeek() {
        var seekto = video.duration * (seekslider.value / 100);
        video.currentTime = seekto;
      }
      function seektimeupdate() {
        var nt = video.currentTime * (100 / video.duration);
        seekslider.value = nt;
        var curmins = Math.floor(video.currentTime / 60);
        var cursecs = Math.floor(video.currentTime - curmins * 60);
        var durmins = Math.floor(video.duration / 60);
        var dursecs = Math.floor(video.duration - durmins * 60);
        if (cursecs < 10) {
          cursecs = "0" + cursecs;
        }
        if (dursecs < 10) {
          dursecs = "0" + dursecs;
        }
        if (curmins < 10) {
          curmins = "0" + curmins;
        }
        if (durmins < 10) {
          durmins = "0" + durmins;
        }
        curtimetext.innerHTML = curmins + ":" + cursecs;
        durtimetext.innerHTML = durmins + ":" + dursecs;
      }
      function showname() {
        var name = document.getElementById("upload");
        alert("Selected file: " + name.files.item(0).name);
      }

      function background1() {
        document.getElementById("myVideo").style.backgroundImage =
          "url('https://cdn.glitch.global/8187eb85-ef03-4f68-a096-53cb26af1633/sans.png?v=1644722605345')"; // specify the image path here
        document.getElementById("hint").innerText = "MEGALOVANIA";
        document.getElementById("hint").style.color = "aqua";
        document.getElementById("title").innerText =
          "Click here to open twicethemegalovania.mp3 in Google Drive";
        document.getElementById("title").style.color = "aqua";
        btn.innerHTML = "MEGALOVANIA";
        btn.style.color = "aqua";
        badtime.innerHTML = "You’re Gonna Have a Bad Time";
      }
      function background2() {
        document.getElementById("myVideo").style.backgroundImage =
          "url('https://cdn.glitch.global/8187eb85-ef03-4f68-a096-53cb26af1633/twiceM.png?v=1644722577921')"; // specify the image path here
        document.getElementById("hint").innerText = "TWICE";
        document.getElementById("hint").style.color = "pink";
        document.getElementById("title").innerText =
          "A web player with many interactive buttons and actions";
        document.getElementById("title").style.color = "white";
        btn.innerHTML = "TWICE";
        btn.style.color = "black";
        badtime.innerHTML = "Reload this page";
      }
      function text1() {
        document.getElementById("tut-volume").style.display = "unset";
      }
      function text2() {
        document.getElementById("tut-volume").style.display = "none";
      }

      function detectmobilebrowser() {
        var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (isMobile) {
          alert("Moblie");
        }
      }

      function SetVolume(val) {
        video.volume = val / 100;
        vlume = video.volume * 100;
        vume = vlume.toFixed();
        document.getElementById("tut-volume").innerHTML =
          "Volume: " + vume + " /" + " 100";
      }

      currentTime();
      // Add event listeners
      seekslider.addEventListener("change", vidSeek, false);
      video.addEventListener("timeupdate", seektimeupdate, false);
      window.addEventListener(
        "keyup",
        function (e) {
          if (!window.screenTop && !window.screenY) {
            if (e.keyCode == 70) {
              closeFullscreen();
            } else {
              if (e.keyCode == 32) {
                console.log("good");
              } else {
                x.className = "playing";
                setTimeout(function () {
                  x.className = x.className.replace("playing", "");
                }, 3000);
              }
            }
          }
        },
        false
      );
      // Try using right-click on the preview page. This script disables that functionality.
      window.addEventListener(
        "contextmenu",
        function (e) {
          openFullscreen();
          e.preventDefault();
        },
        false
      );
      function handleFiles(event) {
        var files = event.target.files;
        $("#src").attr("src", URL.createObjectURL(files[0]));
        document.getElementById("myVideo").load();
      }

      document
        .getElementById("upload")
        .addEventListener("change", handleFiles, false);
      document
        .getElementById("upload")
        .addEventListener("change", musicTitle, false);
      /* The flag that determines whether the wheel event is supported. */
      var supportsWheel = false;

      /* The function that will run when the events are triggered. */
      function DoSomething(e) {
        /* Check whether the wheel event is supported. */
        if (e.type == "wheel") supportsWheel = true;
        else if (supportsWheel) return;

        /* Determine the direction of the scroll (< 0 → up, > 0 → down). */
        var delta = (e.deltaY || -e.wheelDelta || e.detail) >> 10 || 1;

        /* ... */
        console.log(delta);
      }

      /* Add the event listeners for each event. */
      btn.addEventListener("wheel", bpControl);
      btn.addEventListener("mousewheel", bpControl);
      btn.addEventListener("DOMMouseScroll", bpControl);
      elem.addEventListener("wheel", bpControl);
      elem.addEventListener("mousewheel", bpControl);
      elem.addEventListener("DOMMouseScroll", bpControl);

      window.addEventListener(
        "keydown",
        function (e) {
          if (e.keyCode == 32) {
            bpControl();
          }
        },
        false
      );
      // Visualizer
      window.onload = function () {
        var file = document.getElementById("upload");
        var audio = document.getElementById("myVideo");

        file.onchange = function () {
          var files = this.files;
          audio.src = URL.createObjectURL(files[0]);
          audio.load();
          audio.play();
          var context = new AudioContext();
          var src = context.createMediaElementSource(audio);
          var analyser = context.createAnalyser();

          var canvas = document.getElementById("canvas");
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
          var ctx = canvas.getContext("2d");

          src.connect(analyser);
          analyser.connect(context.destination);

          analyser.fftSize = 256;

          var bufferLength = analyser.frequencyBinCount;
          console.log(bufferLength);

          var dataArray = new Uint8Array(bufferLength);

          var WIDTH = canvas.width;
          var HEIGHT = canvas.height;

          var barWidth = (WIDTH / bufferLength) * 2.5;
          var barHeight;
          var x = 0;

          function renderFrame() {
            requestAnimationFrame(renderFrame);

            x = 0;

            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = "#000";
            ctx.fillRect(0, 0, WIDTH, HEIGHT);

            for (var i = 0; i < bufferLength; i++) {
              barHeight = dataArray[i];

              var r = barHeight + 25 * (i / bufferLength);
              var g = 250 * (i / bufferLength);
              var b = 50;

              ctx.fillStyle = "rgb(" + r + "," + g + "," + b + ")";
              ctx.fillRect(x, HEIGHT - barHeight, barWidth, barHeight);

              x += barWidth + 1;
            }
          }

          audio.play();
          renderFrame();
        };
      };

      var vids = $("video");
      $.each(vids, function () {
        this.controls = false;
      });
      //Loop though all Video tags and set Controls as false
    </script>
    <script>
      $(document).ready(function () {
        if ($("video").prop("muted", false)) {
        }

        $("#clock").click(function () {
          if ($("video").prop("muted")) {
            $("video").prop("muted", false);
          } else {
            $("video").prop("muted", true);
          }
        });
      });

      $("#fullscreenVideo").contextmenu(function () {
        if ($("video").prop("muted")) {
          $("video").prop("muted", false);
        } else {
          $("video").prop("muted", true);
        }
      });

      $("#upload").change(function () {
        var i = $(this).prev("label").clone();
        var file = $("#upload")[0].files[0].name;
        $(this).prev("label").text(file);
      });
    </script>
  </body>
</html>
